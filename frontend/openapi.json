{
  "openapi": "3.1.0",
  "info": {
    "title": "tonari-backend",
    "version": "0.0.1"
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health",
        "operationId": "health_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/ingest/syosetu": {
      "post": {
        "tags": [
          "ingest"
        ],
        "summary": "Ingest Syosetu",
        "operationId": "ingest_syosetu_ingest_syosetu_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/IngestSyosetuRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChapterOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/chapter-translations/": {
      "post": {
        "tags": [
          "chapter-translations"
        ],
        "summary": "Create Chapter Translation",
        "operationId": "create_chapter_translation_chapter_translations__post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChapterTranslationCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChapterTranslationOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/chapter-translations/{ct_id}": {
      "get": {
        "tags": [
          "chapter-translations"
        ],
        "summary": "Get Chapter Translation",
        "operationId": "get_chapter_translation_chapter_translations__ct_id__get",
        "parameters": [
          {
            "name": "ct_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Ct Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChapterTranslationOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/chapter-translations/{ct_id}/segments": {
      "get": {
        "tags": [
          "chapter-translations"
        ],
        "summary": "List Translation Segments",
        "operationId": "list_translation_segments_chapter_translations__ct_id__segments_get",
        "parameters": [
          {
            "name": "ct_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Ct Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/TranslationSegmentOut"
                  },
                  "title": "Response List Translation Segments Chapter Translations  Ct Id  Segments Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/": {
      "get": {
        "tags": [
          "works"
        ],
        "summary": "Search Works",
        "operationId": "search_works_works__get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Q"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 50,
              "title": "Limit"
            }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0,
              "title": "Offset"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaginatedWorksOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/import": {
      "post": {
        "tags": [
          "works"
        ],
        "summary": "Import Work",
        "operationId": "import_work_works_import_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WorkImportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WorkOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/{work_id}": {
      "get": {
        "tags": [
          "works"
        ],
        "summary": "Get Work",
        "operationId": "get_work_works__work_id__get",
        "parameters": [
          {
            "name": "work_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Work Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WorkOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/{work_id}/chapters": {
      "get": {
        "tags": [
          "works"
        ],
        "summary": "List Chapters For Work",
        "operationId": "list_chapters_for_work_works__work_id__chapters_get",
        "parameters": [
          {
            "name": "work_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Work Id"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 50,
              "title": "Limit"
            }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0,
              "title": "Offset"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaginatedChaptersOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/{work_id}/chapters/{chapter_id}": {
      "get": {
        "tags": [
          "works"
        ],
        "summary": "Get Chapter For Work",
        "operationId": "get_chapter_for_work_works__work_id__chapters__chapter_id__get",
        "parameters": [
          {
            "name": "work_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Work Id"
            }
          },
          {
            "name": "chapter_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Chapter Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChapterDetailOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/works/{work_id}/scrape-chapters": {
      "post": {
        "tags": [
          "works"
        ],
        "summary": "Request Chapter Scrape",
        "operationId": "request_chapter_scrape_works__work_id__scrape_chapters_post",
        "parameters": [
          {
            "name": "work_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Work Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChapterScrapeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChapterScrapeResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ChapterDetailOut": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "work_id": {
            "type": "integer",
            "title": "Work Id"
          },
          "idx": {
            "type": "integer",
            "title": "Idx"
          },
          "sort_key": {
            "type": "number",
            "title": "Sort Key"
          },
          "title": {
            "type": "string",
            "title": "Title"
          },
          "normalized_text": {
            "type": "string",
            "title": "Normalized Text"
          }
        },
        "type": "object",
        "required": [
          "id",
          "work_id",
          "idx",
          "sort_key",
          "title",
          "normalized_text"
        ],
        "title": "ChapterDetailOut"
      },
      "ChapterOut": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "work_id": {
            "type": "integer",
            "title": "Work Id"
          },
          "idx": {
            "type": "integer",
            "title": "Idx"
          },
          "sort_key": {
            "type": "number",
            "title": "Sort Key"
          },
          "title": {
            "type": "string",
            "title": "Title"
          }
        },
        "type": "object",
        "required": [
          "id",
          "work_id",
          "idx",
          "sort_key",
          "title"
        ],
        "title": "ChapterOut"
      },
      "ChapterScrapeErrorItem": {
        "properties": {
          "chapter": {
            "type": "number",
            "title": "Chapter"
          },
          "reason": {
            "type": "string",
            "title": "Reason"
          }
        },
        "type": "object",
        "required": [
          "chapter",
          "reason"
        ],
        "title": "ChapterScrapeErrorItem"
      },
      "ChapterScrapeRequest": {
        "properties": {
          "start": {
            "type": "number",
            "minimum": 1.0,
            "title": "Start",
            "description": "Starting chapter number (supports decimals)"
          },
          "end": {
            "type": "number",
            "minimum": 1.0,
            "title": "End",
            "description": "Ending chapter number (supports decimals)"
          },
          "force": {
            "type": "boolean",
            "title": "Force",
            "description": "If true, rescrape existing chapters",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "start",
          "end"
        ],
        "title": "ChapterScrapeRequest"
      },
      "ChapterScrapeResponse": {
        "properties": {
          "work_id": {
            "type": "integer",
            "title": "Work Id"
          },
          "start": {
            "type": "number",
            "title": "Start"
          },
          "end": {
            "type": "number",
            "title": "End"
          },
          "force": {
            "type": "boolean",
            "title": "Force"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "requested": {
            "type": "integer",
            "title": "Requested"
          },
          "created": {
            "type": "integer",
            "title": "Created"
          },
          "updated": {
            "type": "integer",
            "title": "Updated"
          },
          "skipped": {
            "type": "integer",
            "title": "Skipped"
          },
          "errors": {
            "items": {
              "$ref": "#/components/schemas/ChapterScrapeErrorItem"
            },
            "type": "array",
            "title": "Errors"
          }
        },
        "type": "object",
        "required": [
          "work_id",
          "start",
          "end",
          "force",
          "status",
          "requested",
          "created",
          "updated",
          "skipped"
        ],
        "title": "ChapterScrapeResponse"
      },
      "ChapterTranslationCreate": {
        "properties": {
          "chapter_id": {
            "type": "integer",
            "title": "Chapter Id"
          },
          "cache_policy": {
            "type": "string",
            "title": "Cache Policy",
            "default": "reuse"
          },
          "params": {
            "anyOf": [
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Params"
          }
        },
        "type": "object",
        "required": [
          "chapter_id"
        ],
        "title": "ChapterTranslationCreate"
      },
      "ChapterTranslationOut": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "chapter_id": {
            "type": "integer",
            "title": "Chapter Id"
          },
          "status": {
            "type": "string",
            "title": "Status"
          }
        },
        "type": "object",
        "required": [
          "id",
          "chapter_id",
          "status"
        ],
        "title": "ChapterTranslationOut"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "IngestSyosetuRequest": {
        "properties": {
          "novel_id": {
            "type": "string",
            "pattern": "^n[a-z0-9]+$",
            "title": "Novel Id",
            "description": "Syosetu novel identifier (e.g. n4811fg)"
          },
          "chapter": {
            "type": "integer",
            "minimum": 1.0,
            "title": "Chapter",
            "description": "Chapter number (1-indexed) to fetch"
          }
        },
        "type": "object",
        "required": [
          "novel_id",
          "chapter"
        ],
        "title": "IngestSyosetuRequest"
      },
      "PaginatedChaptersOut": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/ChapterOut"
            },
            "type": "array",
            "title": "Items"
          },
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "limit": {
            "type": "integer",
            "title": "Limit"
          },
          "offset": {
            "type": "integer",
            "title": "Offset"
          }
        },
        "type": "object",
        "required": [
          "items",
          "total",
          "limit",
          "offset"
        ],
        "title": "PaginatedChaptersOut"
      },
      "PaginatedWorksOut": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/WorkOut"
            },
            "type": "array",
            "title": "Items"
          },
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "limit": {
            "type": "integer",
            "title": "Limit"
          },
          "offset": {
            "type": "integer",
            "title": "Offset"
          }
        },
        "type": "object",
        "required": [
          "items",
          "total",
          "limit",
          "offset"
        ],
        "title": "PaginatedWorksOut"
      },
      "TranslationSegmentOut": {
        "properties": {
          "start": {
            "type": "integer",
            "title": "Start"
          },
          "end": {
            "type": "integer",
            "title": "End"
          },
          "order_index": {
            "type": "integer",
            "title": "Order Index"
          },
          "src": {
            "type": "string",
            "title": "Src"
          },
          "tgt": {
            "type": "string",
            "title": "Tgt"
          },
          "flags": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Flags"
          }
        },
        "type": "object",
        "required": [
          "start",
          "end",
          "order_index",
          "src",
          "tgt"
        ],
        "title": "TranslationSegmentOut"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      },
      "WorkImportRequest": {
        "properties": {
          "url": {
            "type": "string",
            "minLength": 1,
            "format": "uri",
            "title": "Url",
            "description": "URL to the work homepage or chapter"
          },
          "force": {
            "type": "boolean",
            "title": "Force",
            "description": "Force re-sync even if the work exists",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "url"
        ],
        "title": "WorkImportRequest"
      },
      "WorkOut": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "title": {
            "type": "string",
            "title": "Title"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "source_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source Id"
          },
          "source_meta": {
            "anyOf": [
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source Meta"
          }
        },
        "type": "object",
        "required": [
          "id",
          "title"
        ],
        "title": "WorkOut"
      }
    }
  }
}